# Отчет по лабораторной работе №2

## Тема: Система обработки заказов с динамическими скидками (паттерны «Декоратор» и «Стратегия»)

### 1. Постановка задачи

Реализовать модуль обработки заказов, позволяющий:
1. Наращивать функциональность расчёта стоимости заказа путем последовательного применения разных скидок (структурный паттерн «Декоратор»).
2. Гибко выбирать алгоритм расчёта стоимости доставки (поведенческий паттерн «Стратегия»).

### 2. Архитектура решения

Компоненты (заказ):
- `Order` — абстрактный компонент (интерфейс) с методами `get_total_cost()` и `get_description()`.
- `BasicOrder` — конкретный компонент: хранит товары как словарь `{название: (цена, количество)}` и считает базовую стоимость.

Декораторы скидок:
- `OrderDiscountDecorator` — базовый декоратор (держит ссылку на другой `Order`).
- `PercentageDiscount` — процентная скидка (умножение на `(1 - p/100)`).
- `FixedAmountDiscount` — вычитает фиксированную сумму (не опускаясь ниже 0).
- `LoyaltyDiscount` — скидка для уровня лояльности (формула: `стоимость * (1 - 0.05 * level)`).

Стратегии доставки:
- `DeliveryCostStrategy` — интерфейс с методом `calculate_cost(distance, weight, order_total)`.
- `StandardDelivery` — базовая формула: `50 + 2*distance + 5*weight`.
- `ExpressDelivery` — ускоренная формула: `100 + 4*distance + 10*weight`.
- `FreeDeliveryThreshold` — бесплатная доставка при достижении порога суммы заказа, иначе использует формулу как стандартная.

Интеграция:
- `OrderProcessor` — принимает заказ и стратегию доставки, формирует сводку.

### 3. Логика применения скидок

Скидки применяются в том порядке, в котором оборачиваются декораторами. Поэтому итоговая стоимость НЕ равна простой сумме/разности отдельных эффектов — каждый следующий декоратор работает уже с результатом предыдущего.

В демонстрации порядок такой:
1. `PercentageDiscount(10)` — уменьшает базовую сумму на 10%.
2. `FixedAmountDiscount(100)` — затем вычитает 100 единиц.
3. `LoyaltyDiscount(level=2)` — дополнительно уменьшает оставшееся значение на 10% (2 * 5%).

### 4. Пример использования

```python
from order import BasicOrder, PercentageDiscount, FixedAmountDiscount, LoyaltyDiscount
from delivery import StandardDelivery, ExpressDelivery, FreeDeliveryThreshold
from order_processor import OrderProcessor

items = {
    "Ноутбук": (1000, 1),
    "Мышь": (50, 2),
    "Клавиатура": (150, 1)
}

order = BasicOrder(items)
order = PercentageDiscount(order, 10)      
order = FixedAmountDiscount(order, 100)    
order = LoyaltyDiscount(order, 2)          

processor = OrderProcessor(order, StandardDelivery())
print(processor.get_order_summary(distance=10, weight=3))
```

### 5. Пошаговый расчет (пример)

Базовая стоимость:
```
Ноутбук 1000 * 1 = 1000
Мышь 50 * 2 = 100
Клавиатура 150 * 1 = 150
Итого базово: 1250
```
1. После 10% скидки: 1250 * 0.90 = 1125.00
2. После фиксированной скидки 100: 1025.00
3. После скидки лояльности (уровень 2 → 10%): 1025 * 0.90 = 922.50

(В итоговом выводе форматирование может отличаться в зависимости от округления.)

### 6. Пример запуска 

Фактический вывод (после исправления опечатки в строке лояльности):
```
--- Стандартная доставка ---
Заказ: Ноутбук x1, Мышь x2, Клавиатура x1 | 10% скидка | -100 Фиксированная скидка | Уровень скидок 2
Стоимость заказа: 922.50
Стоимость доставки: 71.00
Итого: 993.50

--- Экспресс-доставка ---
Заказ: Ноутбук x1, Мышь x2, Клавиатура x1 | 10% скидка | -100 Фиксированная скидка | Уровень скидок 2
Стоимость заказа: 922.50
Стоимость доставки: 142.00
Итого: 1064.50

--- Бесплатная доставка ---
Заказ: Ноутбук x1, Мышь x2, Клавиатура x1 | 10% скидка | -100 Фиксированная скидка | Уровень скидок 2
Стоимость заказа: 922.50
Стоимость доставки: 71.00
Итого: 993.50
```
